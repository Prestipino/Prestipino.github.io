<nav class="toc-nav">
  {% assign headings = content | split: '<h' %}
  {% assign has_headings = false %}
  
  <ul class="toc-list">
  {% for heading in headings %}
    {% assign heading_trimmed = heading | strip %}
    {% if heading_trimmed.size > 0 %}
      {% assign first_char = heading_trimmed | slice: 0 %}
      
      <!-- Check if this starts with a number 1-6 (h1-h6) -->
      {% if first_char >= '1' and first_char <= '6' %}
        {% if heading contains 'id=' %}
          {% assign has_headings = true %}
          
          <!-- Extract ID -->
          {% assign id_start = heading | split: 'id="' | last %}
          {% assign id = id_start | split: '"' | first %}
          
          <!-- Extract TITLE - FIXED METHOD -->
          {% assign after_closing_bracket = heading | split: '>' | last %}
          {% assign title = after_closing_bracket | split: '</h' | first %}
          
          <!-- Clean up the title -->
          {% assign clean_title = title | strip_html | strip %}
          
          <li class="toc-h{{ first_char }}">
            <a href="#{{ id }}">{{ clean_title }}</a>
          </li>
        {% endif %}
      {% endif %}
    {% endif %}
  {% endfor %}
  
  {% unless has_headings %}
    <li class="toc-empty">No headings with IDs found in this page.</li>
  {% endunless %}
  </ul>
</nav>
