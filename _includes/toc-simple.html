<nav class="toc-nav">
  {% comment %} 
  BULLETPROOF TOC EXTRACTION
  This handles various HTML formats
  {% endcomment %}
  
  <ul class="toc-list">
    {% comment %} Extract H2 headings {% endcomment %}
    {% assign h2_parts = content | split: '<h2' %}
    {% for part in h2_parts %}
      {% if part contains 'id=' %}
        {% assign id_section = part | split: 'id="' | last %}
        {% assign id = id_section | split: '"' | first %}
        
        {% assign after_id = id_section | split: '"' | last %}
        {% assign title_raw = after_id | split: '>' | last %}
        {% assign title = title_raw | split: '</h2' | first | strip %}
        
        {% if title.size > 0 %}
          <li class="toc-h2">
            <a href="#{{ id }}">{{ title }}</a>
          </li>
        {% endif %}
      {% endif %}
    {% endfor %}
    
    {% comment %} Extract H3 headings {% endcomment %}
    {% assign h3_parts = content | split: '<h3' %}
    {% for part in h3_parts %}
      {% if part contains 'id=' %}
        {% assign id_section = part | split: 'id="' | last %}
        {% assign id = id_section | split: '"' | first %}
        
        {% assign after_id = id_section | split: '"' | last %}
        {% assign title_raw = after_id | split: '>' | last %}
        {% assign title = title_raw | split: '</h3' | first | strip %}
        
        {% if title.size > 0 %}
          <li class="toc-h3">
            <a href="#{{ id }}">{{ title }}</a>
          </li>
        {% endif %}
      {% endif %}
    {% endfor %}
  </ul>
  
  {% if content contains '<h2' or content contains '<h3' %}
    {% comment %} Good - we have headings {% endcomment %}
  {% else %}
    <p class="toc-empty">No H2 or H3 headings found in this page.</p>
  {% endif %}
</nav>
